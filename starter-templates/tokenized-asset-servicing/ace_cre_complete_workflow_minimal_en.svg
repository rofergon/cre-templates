<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 980" width="100%" height="100%" style="background:#f8fafc;font-family:'Segoe UI','Inter',sans-serif;">
  <defs>
    <filter id="s" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="3" stdDeviation="5" flood-color="#000" flood-opacity="0.10"/>
    </filter>
    <linearGradient id="gHead" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#1d4ed8"/>
      <stop offset="100%" stop-color="#1e3a8a"/>
    </linearGradient>
    <linearGradient id="gSetup" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#e0f2fe"/>
      <stop offset="100%" stop-color="#dbeafe"/>
    </linearGradient>
    <linearGradient id="gRun" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#ecfeff"/>
      <stop offset="100%" stop-color="#eef2ff"/>
    </linearGradient>
    <marker id="aBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto">
      <path d="M0 0 L10 5 L0 10 z" fill="#1d4ed8"/>
    </marker>
    <marker id="aGreen" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto">
      <path d="M0 0 L10 5 L0 10 z" fill="#15803d"/>
    </marker>
    <marker id="aDark" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto">
      <path d="M0 0 L10 5 L0 10 z" fill="#334155"/>
    </marker>
  </defs>

  <text x="800" y="52" font-size="32" font-weight="700" fill="#0f172a" text-anchor="middle">CRE + ACE Workflow (Minimal)</text>
  <text x="800" y="80" font-size="14" fill="#475569" text-anchor="middle">Policy engine setup + private operations + employee-side redeem</text>

  <rect x="40" y="110" width="1520" height="830" rx="20" fill="#fff" stroke="#cbd5e1" stroke-width="2" filter="url(#s)"/>

  <rect x="70" y="140" width="1460" height="200" rx="14" fill="url(#gSetup)" stroke="#93c5fd" stroke-width="2"/>
  <rect x="70" y="365" width="1460" height="545" rx="14" fill="url(#gRun)" stroke="#a5b4fc" stroke-width="2"/>

  <rect x="70" y="140" width="1460" height="42" rx="14" fill="url(#gHead)"/>
  <text x="120" y="168" font-size="17" font-weight="700" fill="#fff">Phase 1: ACE Setup</text>

  <rect x="110" y="220" width="360" height="90" rx="10" fill="#fff" stroke="#7dd3fc" stroke-width="2"/>
  <text x="290" y="252" font-size="15" font-weight="700" fill="#0c4a6e" text-anchor="middle">Deploy Policy Engine</text>
  <text x="290" y="274" font-size="12" fill="#0369a1" text-anchor="middle">Foundry script</text>

  <rect x="530" y="220" width="360" height="90" rx="10" fill="#fff" stroke="#7dd3fc" stroke-width="2"/>
  <text x="710" y="252" font-size="15" font-weight="700" fill="#0c4a6e" text-anchor="middle">Register / Update Vault</text>
  <text x="710" y="274" font-size="12" fill="#0369a1" text-anchor="middle">`ace:setup-policy`</text>

  <rect x="950" y="220" width="480" height="90" rx="10" fill="#fff" stroke="#7dd3fc" stroke-width="2"/>
  <text x="1190" y="252" font-size="15" font-weight="700" fill="#0c4a6e" text-anchor="middle">Policy Checks OK</text>
  <text x="1190" y="274" font-size="12" fill="#15803d" text-anchor="middle">deposit / withdraw / private-transfer</text>

  <path d="M470 265 L530 265" stroke="#334155" stroke-width="3" fill="none" marker-end="url(#aDark)"/>
  <path d="M890 265 L950 265" stroke="#334155" stroke-width="3" fill="none" marker-end="url(#aDark)"/>

  <rect x="70" y="365" width="1460" height="42" rx="14" fill="url(#gHead)"/>
  <text x="120" y="393" font-size="17" font-weight="700" fill="#fff">Phase 2: Operations</text>

  <rect x="100" y="455" width="260" height="90" rx="10" fill="#fff" stroke="#86efac" stroke-width="2"/>
  <text x="230" y="487" font-size="14" font-weight="700" fill="#166534" text-anchor="middle">A) External Trigger</text>
  <text x="230" y="509" font-size="12" fill="#15803d" text-anchor="middle">Lambda / HR JSON</text>

  <rect x="400" y="440" width="350" height="120" rx="10" fill="#fff" stroke="#93c5fd" stroke-width="2"/>
  <text x="575" y="472" font-size="14" font-weight="700" fill="#1e3a8a" text-anchor="middle">B) CRE `main.ts`</text>
  <text x="575" y="494" font-size="12" fill="#1d4ed8" text-anchor="middle">SYNC_* -> onchain report</text>
  <text x="575" y="515" font-size="12" fill="#1d4ed8" text-anchor="middle">ACE_* -> ACE API (EIP-712)</text>
  <text x="575" y="536" font-size="11" fill="#b91c1c" text-anchor="middle">SYNC_REDEEM_TICKET disabled</text>

  <rect x="790" y="455" width="320" height="90" rx="10" fill="#fff" stroke="#93c5fd" stroke-width="2"/>
  <text x="950" y="487" font-size="14" font-weight="700" fill="#1e3a8a" text-anchor="middle">C) SYNC_* Onchain Path</text>
  <text x="950" y="509" font-size="12" fill="#1d4ed8" text-anchor="middle">`writeReport()` -> receiver</text>

  <rect x="1150" y="455" width="350" height="90" rx="10" fill="#fff" stroke="#60a5fa" stroke-width="2"/>
  <text x="1325" y="487" font-size="14" font-weight="700" fill="#1e40af" text-anchor="middle">D) Equity Contracts</text>
  <text x="1325" y="509" font-size="12" fill="#2563eb" text-anchor="middle">Compliance / Vesting / Registry</text>

  <rect x="100" y="620" width="660" height="150" rx="10" fill="#fff" stroke="#34d399" stroke-width="2"/>
  <text x="430" y="652" font-size="14" font-weight="700" fill="#065f46" text-anchor="middle">F) Employee (separate wallet)</text>
  <text x="430" y="674" font-size="12" fill="#047857" text-anchor="middle">`withdraw-and-redeem.ts`</text>
  <text x="430" y="695" font-size="12" fill="#047857" text-anchor="middle">/withdraw -> ticket</text>
  <text x="430" y="716" font-size="12" fill="#047857" text-anchor="middle">`withdrawWithTicket()` on Sepolia</text>
  <text x="430" y="737" font-size="12" fill="#047857" text-anchor="middle">optional transfer to final address</text>

  <rect x="800" y="620" width="700" height="150" rx="10" fill="#fff" stroke="#818cf8" stroke-width="2"/>
  <text x="1150" y="652" font-size="14" font-weight="700" fill="#3730a3" text-anchor="middle">E) ACE Private Path</text>
  <text x="1150" y="674" font-size="12" fill="#4338ca" text-anchor="middle">`ACE_GENERATE_SHIELDED_ADDRESS` -> /shielded-address</text>
  <text x="1150" y="695" font-size="12" fill="#4338ca" text-anchor="middle">`ACE_PRIVATE_TRANSFER` -> /private-transfer</text>
  <text x="1150" y="716" font-size="12" fill="#4338ca" text-anchor="middle">`ACE_WITHDRAW_TICKET` -> /withdraw</text>
  <text x="1150" y="737" font-size="12" fill="#4338ca" text-anchor="middle">policy checks in ACE vault</text>

  <rect x="500" y="810" width="600" height="80" rx="10" fill="#fefce8" stroke="#facc15" stroke-width="2"/>
  <text x="800" y="842" font-size="15" font-weight="700" fill="#854d0e" text-anchor="middle">Outcome</text>
  <text x="800" y="864" font-size="12" fill="#a16207" text-anchor="middle">ACE compliance + privacy before withdrawal + employee-side onchain redeem</text>

  <path d="M360 500 L400 500" stroke="#1d4ed8" stroke-width="3" fill="none" marker-end="url(#aBlue)"/>
  <path d="M750 500 L790 500" stroke="#1d4ed8" stroke-width="3" fill="none" marker-end="url(#aBlue)"/>
  <path d="M1110 500 L1150 500" stroke="#1d4ed8" stroke-width="3" fill="none" marker-end="url(#aBlue)"/>

  <path d="M740 560 L800 620" stroke="#1d4ed8" stroke-width="2.5" fill="none" marker-end="url(#aBlue)"/>
  <path d="M430 770 L430 810 L560 810" stroke="#15803d" stroke-width="3" fill="none" marker-end="url(#aGreen)"/>
  <path d="M1150 770 L1150 850 L1100 850" stroke="#1d4ed8" stroke-width="3" fill="none" marker-end="url(#aBlue)"/>
</svg>
