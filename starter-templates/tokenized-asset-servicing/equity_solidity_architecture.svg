<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" width="100%" height="100%" style="background-color: #f1f5f9; font-family: 'Segoe UI', 'Inter', -apple-system, sans-serif;">
  <defs>
    <!-- Shadows -->
    <filter id="shadow-md" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000000" flood-opacity="0.08"/>
    </filter>
    <filter id="shadow-lg" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="#000000" flood-opacity="0.12"/>
    </filter>
    
    <!-- Gradients -->
    <linearGradient id="web3-grad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#343a40"/>
      <stop offset="100%" stop-color="#1e2225"/>
    </linearGradient>

    <!-- Arrow Markers -->
    <marker id="arrowSolid" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#64748b"/>
    </marker>
    <marker id="arrowBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#3b82f6"/>
    </marker>
    <marker id="arrowGreen" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="4" markerHeight="4" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#10b981"/>
    </marker>
    <marker id="arrowRed" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#ef4444"/>
    </marker>
    <marker id="arrowPurple" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#8b5cf6"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="50" font-size="32" font-weight="bold" fill="#0f172a" text-anchor="middle">Equity Protocol: Smart Contract Architecture</text>
  <text x="600" y="80" font-size="16" fill="#475569" text-anchor="middle">ERC-3643 Tokenized Asset Interactions &amp; Vesting Rules (v2 — CRE Full Flow)</text>

  <!-- Main Web3 Container -->
  <rect x="80" y="120" width="1040" height="640" rx="16" fill="url(#web3-grad)" filter="url(#shadow-lg)"/>
  <text x="600" y="160" font-size="24" font-weight="bold" fill="#ffffff" text-anchor="middle">On-Chain Base Sepolia EVM</text>


  <!-- ==================== LEFT: INPUTS & ORACLES ==================== -->
  
  <rect x="120" y="200" width="220" height="520" rx="8" fill="#292e33" stroke="#475569" stroke-width="1"/>
  <text x="230" y="235" font-size="16" font-weight="bold" fill="#cbd5e1" text-anchor="middle">External Triggers</text>

  <!-- DON Forwarder -->
  <rect x="140" y="270" width="180" height="60" rx="6" fill="#334155" stroke="#64748b" stroke-width="2"/>
  <text x="230" y="300" font-size="14" font-weight="bold" fill="#f8fafc" text-anchor="middle">Chainlink DON</text>
  <text x="230" y="316" font-size="11" fill="#94a3b8" text-anchor="middle">Verified Off-Chain Data</text>

  <rect x="140" y="470" width="180" height="60" rx="6" fill="#334155" stroke="#64748b" stroke-width="2"/>
  <text x="230" y="500" font-size="14" font-weight="bold" fill="#f8fafc" text-anchor="middle">Employees</text>
  <text x="230" y="516" font-size="11" fill="#94a3b8" text-anchor="middle">Calls to claim()</text>

  <rect x="140" y="590" width="180" height="60" rx="6" fill="#334155" stroke="#64748b" stroke-width="2"/>
  <text x="230" y="620" font-size="14" font-weight="bold" fill="#f8fafc" text-anchor="middle">Protocol Admin</text>
  <text x="230" y="636" font-size="11" fill="#94a3b8" text-anchor="middle">Funds Pool &amp; Admin Config</text>


  <!-- ==================== CENTER & RIGHT: CORE CONTRACTS ==================== -->

  <!-- Receiver Contract (Top Middle) -->
  <rect x="400" y="230" width="300" height="110" rx="8" fill="#4f46e5" stroke="#818cf8" stroke-width="2" filter="url(#shadow-md)"/>
  <text x="550" y="260" font-size="18" font-weight="bold" fill="#ffffff" text-anchor="middle">EquityWorkflowReceiver.sol</text>
  <rect x="420" y="275" width="260" height="50" rx="6" fill="#3730a3"/>
  <text x="550" y="293" font-size="11" fill="#c7d2fe" text-anchor="middle">Routes calls using abi.decode</text>
  <text x="550" y="308" font-size="10" font-weight="bold" fill="#a5b4fc" text-anchor="middle">ActionTypes: KYC(0) EMP(1) GOAL(2) FREEZE(3) GRANT(4)</text>


  <!-- Employee Vesting (Middle Bottom) -->
  <rect x="400" y="400" width="300" height="220" rx="8" fill="#1e293b" stroke="#38bdf8" stroke-width="2" filter="url(#shadow-md)"/>
  <text x="550" y="430" font-size="18" font-weight="bold" fill="#f8fafc" text-anchor="middle">EmployeeVesting.sol</text>
  
  <rect x="420" y="445" width="260" height="24" rx="4" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <text x="430" y="461" font-size="11" fill="#cbd5e1">Goals &amp; Employment Check (onlyOracle)</text>

  <rect x="420" y="475" width="260" height="24" rx="4" fill="#312e81" stroke="#8b5cf6" stroke-width="1"/>
  <text x="430" y="491" font-size="11" fill="#c4b5fd">createGrant() — onlyOracle (CRE/Owner)</text>

  <rect x="420" y="505" width="260" height="24" rx="4" fill="#064e3b" stroke="#10b981" stroke-width="1"/>
  <text x="430" y="521" font-size="11" fill="#6ee7b7">fundVesting(amount) — onlyOwner</text>

  <rect x="420" y="535" width="260" height="24" rx="4" fill="#450a0a" stroke="#ef4444" stroke-width="1"/>
  <text x="430" y="551" font-size="11" fill="#fca5a5">if (time &lt; cliffDuration) return 0;</text>

  <rect x="420" y="565" width="260" height="24" rx="4" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <text x="430" y="581" font-size="11" fill="#cbd5e1">calculateVestedAmount()</text>

  <rect x="420" y="595" width="260" height="18" rx="4" fill="#0f172a" stroke="#10b981" stroke-width="1"/>
  <text x="550" y="609" font-size="11" font-weight="bold" fill="#34d399" text-anchor="middle">claim() -&gt; token.transfer()</text>


  <!-- Compliance Container (Right Side) -->
  <rect x="750" y="200" width="320" height="520" rx="8" fill="none" stroke="#475569" stroke-width="1" stroke-dasharray="4"/>
  <text x="910" y="230" font-size="14" font-weight="bold" fill="#94a3b8" text-anchor="middle">ERC-3643 Tokenized Asset Core</text>

  <!-- Identity Registry -->
  <rect x="780" y="260" width="260" height="90" rx="6" fill="#1e293b" stroke="#94a3b8" stroke-width="2"/>
  <text x="910" y="290" font-size="16" font-weight="bold" fill="#f8fafc" text-anchor="middle">IdentityRegistry.sol</text>
  <rect x="800" y="305" width="220" height="30" rx="4" fill="#0f172a"/>
  <text x="910" y="325" font-size="12" fill="#94a3b8" text-anchor="middle">isVerified() / setCountry()</text>


  <!-- Token (The Bottom Rock) -->
  <rect x="780" y="580" width="260" height="120" rx="8" fill="#1e293b" stroke="#eab308" stroke-width="2" filter="url(#shadow-md)"/>
  <text x="910" y="610" font-size="18" font-weight="bold" fill="#fef08a" text-anchor="middle">Token.sol (ERC-3643)</text>
  <text x="910" y="630" font-size="11" fill="#94a3b8" text-anchor="middle">Extends ERC20 + Freeze Logic</text>
  <rect x="800" y="650" width="220" height="34" rx="4" fill="#422006" stroke="#ca8a04" stroke-width="1"/>
  <text x="910" y="670" font-size="12" font-weight="bold" fill="#fef08a" text-anchor="middle">transfer() // requires validation</text>


  <!-- Compliance Logic (Middle Right) -->
  <rect x="780" y="400" width="260" height="90" rx="6" fill="#1e293b" stroke="#ef4444" stroke-width="2"/>
  <text x="910" y="428" font-size="16" font-weight="bold" fill="#f8fafc" text-anchor="middle">Compliance.sol</text>
  <rect x="800" y="440" width="220" height="20" rx="4" fill="#450a0a"/>
  <text x="910" y="454" font-size="11" fill="#fca5a5" text-anchor="middle">canTransfer(from, to, amount)</text>
  <rect x="800" y="465" width="220" height="16" rx="2" fill="#0f172a"/>
  <text x="910" y="477" font-size="10" fill="#94a3b8" text-anchor="middle">requires isTokenBound()</text>



  <!-- ==================== FLOW ARROWS ==================== -->

  <!-- Chainlink > Receiver -->
  <path d="M 320 300 L 400 300" fill="none" stroke="#64748b" stroke-width="3" marker-end="url(#arrowSolid)"/>
  
  <!-- Employees > Vesting -->
  <path d="M 320 500 L 360 500 L 360 490 L 400 490" fill="none" stroke="#64748b" stroke-width="2" marker-end="url(#arrowSolid)"/>
  
  <!-- Admin > Vesting (fundVesting) -->
  <path d="M 320 620 L 360 620 L 360 510 L 400 510" fill="none" stroke="#8b5cf6" stroke-dasharray="4" stroke-width="2" marker-end="url(#arrowPurple)"/>
  <text x="367" y="565" font-size="10" fill="#c4b5fd">fundVesting()</text>


  <!-- Receiver > Contracts -->
  <!-- Splitting backbone from Receiver -->
  <path d="M 550 340 L 550 365" fill="none" stroke="#3b82f6" stroke-width="2"/>

  <!-- Receiver to Vesting -->
  <path d="M 550 365 L 550 400" fill="none" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
  
  <!-- Receiver to Identity (Right turn) -->
  <path d="M 550 365 L 750 365 L 750 305 L 780 305" fill="none" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
  
  <!-- Receiver to Token (Down then Right) -->
  <path d="M 550 365 L 715 365 L 715 595 L 780 595" fill="none" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>

  <!-- Path Overlays -->
  <rect x="475" y="375" width="85" height="18" rx="4" fill="#1e293b"/>
  <text x="518" y="388" font-size="9" fill="#93c5fd" text-anchor="middle">Grants/Goals/Emp</text>

  <rect x="660" y="356" width="70" height="18" rx="4" fill="#1e293b"/>
  <text x="695" y="369" font-size="9" fill="#93c5fd" text-anchor="middle">KYC / Verified</text>

  <rect x="730" y="586" width="40" height="18" rx="4" fill="#1e293b"/>
  <text x="750" y="599" font-size="9" fill="#93c5fd" text-anchor="middle">Freeze</text>


  <!-- Vesting to Token (The Claim Transfer) -->
  <!-- Label below EmployeeVesting -->
  <rect x="530" y="630" width="120" height="24" rx="4" fill="#0f172a" stroke="#059669" stroke-width="1"/>
  <text x="590" y="646" font-size="10" font-weight="bold" fill="#34d399" text-anchor="middle">claim() → transfer()</text>
  <!-- Arrow: label → right to Token left edge -->
  <path d="M 650 642 L 775 642" fill="none" stroke="#10b981" stroke-width="3" marker-end="url(#arrowGreen)"/>


  <!-- Token requiring Identity & Compliance -->
  <!-- Token UP to Identity -->
  <path d="M 1040 640 L 1055 640 L 1055 305 L 1040 305" fill="none" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrowRed)"/>
  <text x="1063" y="472" font-size="10" fill="#ef4444" writing-mode="tb" alignment-baseline="middle">REQUIRES isVerified = true</text>
  
  <!-- Token UP to Compliance -->
  <path d="M 890 580 L 890 495" fill="none" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrowRed)"/>
  <rect x="836" y="530" width="108" height="18" rx="4" fill="#1e293b"/>
  <text x="890" y="543" font-size="9" fill="#ef4444" text-anchor="middle">REQUIRES canTransfer</text>

  <!-- Compliance DOWN to Token (Response) -->
  <path d="M 980 495 L 980 580" fill="none" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="2 4" marker-end="url(#arrowRed)"/>
  <rect x="940" y="530" width="80" height="18" rx="4" fill="#1e293b"/>
  <text x="980" y="543" font-size="9" fill="#fca5a5" text-anchor="middle">Returns Boolean</text>


</svg>
