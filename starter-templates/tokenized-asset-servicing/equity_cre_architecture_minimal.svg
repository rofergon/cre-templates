<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1280 760" width="100%" height="100%" style="background:#f4f8fc;font-family:'Segoe UI','Inter',Arial,sans-serif;">
  <defs>
    <filter id="shadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="3" stdDeviation="5" flood-color="#0f172a" flood-opacity="0.14"/>
    </filter>

    <linearGradient id="creHead" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#2858cf"/>
      <stop offset="100%" stop-color="#1d3ea0"/>
    </linearGradient>

    <marker id="arrBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb"/>
    </marker>
    <marker id="arrGreen" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#10b981"/>
    </marker>
    <marker id="arrPurple" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#7c3aed"/>
    </marker>
  </defs>

  <text x="640" y="50" font-size="31" font-weight="700" fill="#0f172a" text-anchor="middle">Equity + CRE + ACE (Flujo Simplificado)</text>
  <text x="640" y="78" font-size="14" fill="#475569" text-anchor="middle">Vista mínima del proceso end-to-end más importante</text>

  <!-- lanes -->
  <rect x="30" y="110" width="240" height="600" rx="14" fill="#ffffff" stroke="#cbd5e1" stroke-width="2" filter="url(#shadow)"/>
  <text x="150" y="145" font-size="20" font-weight="700" fill="#334155" text-anchor="middle">Web2</text>

  <rect x="295" y="110" width="320" height="600" rx="14" fill="#ffffff" stroke="#1d4ed8" stroke-width="3" filter="url(#shadow)"/>
  <rect x="295" y="110" width="320" height="62" rx="14" fill="url(#creHead)"/>
  <path d="M 295 156 L 615 156 L 615 172 L 295 172 Z" fill="url(#creHead)"/>
  <text x="455" y="145" font-size="21" font-weight="700" fill="#ffffff" text-anchor="middle">CRE</text>
  <text x="455" y="165" font-size="11" fill="#dbeafe" text-anchor="middle">main.ts + capabilities</text>

  <rect x="640" y="110" width="290" height="600" rx="14" fill="#1f2937" filter="url(#shadow)"/>
  <text x="785" y="145" font-size="20" font-weight="700" fill="#ffffff" text-anchor="middle">Onchain</text>

  <rect x="955" y="110" width="295" height="600" rx="14" fill="#ffffff" stroke="#d8b4fe" stroke-width="2" filter="url(#shadow)"/>
  <text x="1102" y="145" font-size="20" font-weight="700" fill="#6d28d9" text-anchor="middle">ACE Rail</text>

  <!-- web2 -->
  <rect x="50" y="200" width="200" height="95" rx="10" fill="#f8fafc" stroke="#dbeafe" stroke-width="2"/>
  <text x="150" y="232" font-size="16" font-weight="700" fill="#1e293b" text-anchor="middle">HR + Lambda</text>
  <text x="150" y="252" font-size="11" fill="#64748b" text-anchor="middle">Recibe estado empleado</text>
  <text x="150" y="269" font-size="11" fill="#64748b" text-anchor="middle">(KYC, empleo, goal, cliff)</text>

  <rect x="50" y="325" width="200" height="120" rx="10" fill="#f8fafc" stroke="#dbeafe" stroke-width="2"/>
  <text x="150" y="356" font-size="15" font-weight="700" fill="#1e293b" text-anchor="middle">Test E2E</text>
  <text x="150" y="377" font-size="11" fill="#64748b" text-anchor="middle">`npm --prefix EquityWorkflowCre`</text>
  <text x="150" y="394" font-size="11" fill="#64748b" text-anchor="middle">`run test:lambda-cre-ace-ticket`</text>
  <text x="150" y="412" font-size="10" fill="#0f766e" text-anchor="middle">Simula todo el ciclo</text>

  <!-- cre -->
  <rect x="318" y="200" width="274" height="88" rx="10" fill="#ecfeff" stroke="#67e8f9" stroke-width="2"/>
  <text x="455" y="231" font-size="16" font-weight="700" fill="#155e75" text-anchor="middle">HTTP Trigger</text>
  <text x="455" y="251" font-size="11" fill="#0f766e" text-anchor="middle">Parsea acción JSON</text>
  <text x="455" y="268" font-size="11" fill="#0f766e" text-anchor="middle">y valida payload</text>

  <rect x="318" y="305" width="274" height="165" rx="10" fill="#eff6ff" stroke="#bfdbfe" stroke-width="2"/>
  <text x="455" y="335" font-size="16" font-weight="700" fill="#1e3a8a" text-anchor="middle">Router de Acciones</text>
  <text x="455" y="356" font-size="11" fill="#334155" text-anchor="middle">Onchain: 0,1,2,3,4,7,8</text>
  <text x="455" y="373" font-size="11" fill="#334155" text-anchor="middle">ACE API: shielded / transfer / withdraw</text>
  <text x="455" y="390" font-size="11" fill="#334155" text-anchor="middle">Firma EIP-712 + arma reporte ABI</text>
  <text x="455" y="410" font-size="10" fill="#64748b" text-anchor="middle">(6 redeem en receiver está deshabilitada)</text>

  <rect x="318" y="490" width="274" height="86" rx="10" fill="#eef2ff" stroke="#a5b4fc" stroke-width="2"/>
  <text x="455" y="521" font-size="15" font-weight="700" fill="#312e81" text-anchor="middle">Write Path</text>
  <text x="455" y="541" font-size="11" fill="#4338ca" text-anchor="middle">`writeReport()` o `onReport()` directo</text>
  <text x="455" y="558" font-size="10" fill="#6366f1" text-anchor="middle">(modo simulación local)</text>

  <rect x="318" y="595" width="274" height="86" rx="10" fill="#f0fdf4" stroke="#86efac" stroke-width="2"/>
  <text x="455" y="626" font-size="15" font-weight="700" fill="#166534" text-anchor="middle">Log Trigger</text>
  <text x="455" y="646" font-size="11" fill="#166534" text-anchor="middle">Sincroniza eventos de vuelta</text>
  <text x="455" y="663" font-size="11" fill="#166534" text-anchor="middle">a Lambda / observabilidad</text>

  <!-- onchain -->
  <rect x="662" y="200" width="246" height="88" rx="10" fill="#4f46e5" stroke="#818cf8" stroke-width="2"/>
  <text x="785" y="232" font-size="16" font-weight="700" fill="#ffffff" text-anchor="middle">EquityWorkflowReceiver</text>
  <text x="785" y="252" font-size="11" fill="#e0e7ff" text-anchor="middle">Despacha acciones a contratos</text>
  <text x="785" y="269" font-size="11" fill="#e0e7ff" text-anchor="middle">de equity y compliance</text>

  <rect x="662" y="307" width="246" height="160" rx="10" fill="#082f49" stroke="#38bdf8" stroke-width="2"/>
  <text x="785" y="337" font-size="15" font-weight="700" fill="#e0f2fe" text-anchor="middle">PrivateEmployeeEquity</text>
  <text x="785" y="357" font-size="11" fill="#bae6fd" text-anchor="middle">employment + goal + cliff</text>
  <text x="785" y="374" font-size="11" fill="#bae6fd" text-anchor="middle">define elegibilidad de claim</text>
  <text x="785" y="391" font-size="11" fill="#bae6fd" text-anchor="middle">y sync freeze del wallet</text>
  <text x="785" y="409" font-size="11" fill="#bae6fd" text-anchor="middle">deposita al vault ACE oficial</text>

  <rect x="662" y="486" width="246" height="86" rx="10" fill="#0f172a" stroke="#22c55e" stroke-width="2"/>
  <text x="785" y="517" font-size="15" font-weight="700" fill="#f8fafc" text-anchor="middle">Token + IdentityRegistry</text>
  <text x="785" y="537" font-size="11" fill="#bbf7d0" text-anchor="middle">mint, freeze y estado KYC</text>
  <text x="785" y="554" font-size="11" fill="#bbf7d0" text-anchor="middle">actualizados por receiver</text>

  <rect x="662" y="590" width="246" height="91" rx="10" fill="#1f2937" stroke="#9ca3af" stroke-width="1.8"/>
  <text x="785" y="621" font-size="15" font-weight="700" fill="#f8fafc" text-anchor="middle">ACE Vault (Sepolia)</text>
  <text x="785" y="641" font-size="11" fill="#d1d5db" text-anchor="middle">`deposit` y `withdrawWithTicket`</text>
  <text x="785" y="658" font-size="11" fill="#d1d5db" text-anchor="middle">con policy engine de ACE</text>

  <!-- ace rail -->
  <rect x="975" y="200" width="255" height="110" rx="10" fill="#ffffff" stroke="#d8b4fe" stroke-width="2"/>
  <text x="1102" y="232" font-size="16" font-weight="700" fill="#5b21b6" text-anchor="middle">ACE API</text>
  <text x="1102" y="252" font-size="11" fill="#6d28d9" text-anchor="middle">/balances /private-transfer</text>
  <text x="1102" y="269" font-size="11" fill="#6d28d9" text-anchor="middle">/withdraw /shielded-address</text>
  <text x="1102" y="286" font-size="10" fill="#7c3aed" text-anchor="middle">requiere auth EIP-712</text>

  <rect x="975" y="328" width="255" height="110" rx="10" fill="#ffffff" stroke="#d8b4fe" stroke-width="2"/>
  <text x="1102" y="360" font-size="16" font-weight="700" fill="#5b21b6" text-anchor="middle">Ticket de Retiro</text>
  <text x="1102" y="380" font-size="11" fill="#6d28d9" text-anchor="middle">Empleado pide `/withdraw`</text>
  <text x="1102" y="397" font-size="11" fill="#6d28d9" text-anchor="middle">recibe `ticket` + `deadline`</text>
  <text x="1102" y="414" font-size="11" fill="#6d28d9" text-anchor="middle">(expira ~1 hora)</text>

  <rect x="975" y="458" width="255" height="145" rx="10" fill="#ffffff" stroke="#d8b4fe" stroke-width="2"/>
  <text x="1102" y="490" font-size="16" font-weight="700" fill="#5b21b6" text-anchor="middle">Empleado Redime Onchain</text>
  <text x="1102" y="510" font-size="11" fill="#6d28d9" text-anchor="middle">wallet del empleado ejecuta:</text>
  <text x="1102" y="527" font-size="11" fill="#7c3aed" font-weight="700" text-anchor="middle">withdrawWithTicket(token, amount, ticket)</text>
  <text x="1102" y="545" font-size="11" fill="#6d28d9" text-anchor="middle">si cumple compliance, retiro exitoso</text>
  <text x="1102" y="562" font-size="11" fill="#6d28d9" text-anchor="middle">si no, revierte o ticket expira/refund</text>

  <rect x="975" y="621" width="255" height="60" rx="10" fill="#faf5ff" stroke="#c084fc" stroke-width="2"/>
  <text x="1102" y="652" font-size="13" font-weight="700" fill="#6d28d9" text-anchor="middle">Resultado: privacidad + compliance ACE</text>

  <!-- arrows -->
  <path d="M 250 248 L 295 248" fill="none" stroke="#2563eb" stroke-width="3" marker-end="url(#arrBlue)"/>
  <path d="M 592 534 L 640 534 L 640 244 L 662 244" fill="none" stroke="#2563eb" stroke-width="3" marker-end="url(#arrBlue)"/>
  <path d="M 592 390 L 975 390" fill="none" stroke="#7c3aed" stroke-width="3" marker-end="url(#arrPurple)"/>

  <path d="M 785 288 L 785 307" fill="none" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrBlue)"/>
  <path d="M 785 467 L 785 486" fill="none" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrBlue)"/>
  <path d="M 785 572 L 785 590" fill="none" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrBlue)"/>

  <path d="M 975 382 L 930 382 L 930 636 L 908 636" fill="none" stroke="#7c3aed" stroke-width="2.5" marker-end="url(#arrPurple)"/>
  <path d="M 908 650 L 975 650" fill="none" stroke="#10b981" stroke-width="3" marker-end="url(#arrGreen)"/>
  <path d="M 662 636 L 615 636" fill="none" stroke="#10b981" stroke-width="3" marker-end="url(#arrGreen)"/>
  <path d="M 318 636 L 270 636 L 270 385 L 250 385" fill="none" stroke="#10b981" stroke-width="3" marker-end="url(#arrGreen)"/>

  <!-- footer -->
  <rect x="30" y="724" width="1220" height="24" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1.5"/>
  <text x="640" y="740" font-size="11" fill="#475569" text-anchor="middle">Red objetivo: Ethereum Sepolia (11155111) | Claim final siempre desde la wallet real del empleado</text>
</svg>
