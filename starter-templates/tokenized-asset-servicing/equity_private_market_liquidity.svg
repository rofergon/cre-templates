<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1680 1020" width="100%" height="100%" style="background:#f3f8fc;font-family:'Segoe UI','Inter',Arial,sans-serif;">
  <defs>
    <filter id="shadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#0f172a" flood-opacity="0.12"/>
    </filter>

    <linearGradient id="laneWeb2" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffffff"/>
      <stop offset="100%" stop-color="#eaf2ff"/>
    </linearGradient>
    <linearGradient id="laneCre" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#2a5ada"/>
      <stop offset="100%" stop-color="#193db0"/>
    </linearGradient>
    <linearGradient id="laneOnchain" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#2f3a48"/>
      <stop offset="100%" stop-color="#111827"/>
    </linearGradient>
    <linearGradient id="laneAce" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffffff"/>
      <stop offset="100%" stop-color="#f3e8ff"/>
    </linearGradient>
    <linearGradient id="laneInvestor" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffffff"/>
      <stop offset="100%" stop-color="#ecfeff"/>
    </linearGradient>

    <marker id="arrBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb"/>
    </marker>
    <marker id="arrGreen" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#10b981"/>
    </marker>
    <marker id="arrPurple" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#7c3aed"/>
    </marker>
    <marker id="arrOrange" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#ea580c"/>
    </marker>
    <marker id="arrGray" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/>
    </marker>
  </defs>

  <text x="840" y="52" font-size="34" font-weight="700" fill="#0f172a" text-anchor="middle">Private Equity Liquidity Market (ERC-3643 + CRE + ACE)</text>
  <text x="840" y="82" font-size="15" fill="#475569" text-anchor="middle">Issuer-custodied private rounds, USDC settlement, ACE privacy rail, and global resale compliance controls</text>

  <!-- Lane containers -->
  <rect x="20" y="120" width="300" height="860" rx="16" fill="url(#laneWeb2)" stroke="#cbd5e1" stroke-width="2" filter="url(#shadow)"/>
  <rect x="340" y="120" width="390" height="860" rx="16" fill="#ffffff" stroke="#1d4ed8" stroke-width="3" filter="url(#shadow)"/>
  <rect x="340" y="120" width="390" height="78" rx="16" fill="url(#laneCre)"/>
  <path d="M 340 182 L 730 182 L 730 198 L 340 198 Z" fill="url(#laneCre)"/>
  <rect x="750" y="120" width="470" height="860" rx="16" fill="url(#laneOnchain)" filter="url(#shadow)"/>
  <rect x="1240" y="120" width="240" height="860" rx="16" fill="url(#laneAce)" stroke="#d8b4fe" stroke-width="2" filter="url(#shadow)"/>
  <rect x="1500" y="120" width="160" height="860" rx="16" fill="url(#laneInvestor)" stroke="#99f6e4" stroke-width="2" filter="url(#shadow)"/>

  <!-- Lane headers -->
  <text x="170" y="166" font-size="22" font-weight="700" fill="#334155" text-anchor="middle">Web2 Ops</text>
  <text x="535" y="169" font-size="22" font-weight="700" fill="#ffffff" text-anchor="middle">CRE Orchestration</text>
  <text x="535" y="191" font-size="12" fill="#dbeafe" text-anchor="middle">main.ts + writeReport + HTTP capability</text>
  <text x="985" y="166" font-size="23" font-weight="700" fill="#ffffff" text-anchor="middle">Onchain Protocol</text>
  <text x="1360" y="166" font-size="22" font-weight="700" fill="#6d28d9" text-anchor="middle">ACE Private Rail</text>
  <text x="1580" y="166" font-size="20" font-weight="700" fill="#0f766e" text-anchor="middle">Investors</text>

  <!-- PHASE labels -->
  <rect x="30" y="212" width="1620" height="30" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1.5"/>
  <text x="55" y="232" font-size="12" font-weight="700" fill="#334155">Phase A: Setup (KYC + investor auth + round config)</text>
  <text x="570" y="232" font-size="12" font-weight="700" fill="#334155">Phase B: Trading (USDC buy -> PENDING)</text>
  <text x="980" y="232" font-size="12" font-weight="700" fill="#334155">Phase C: ACE settlement/refund</text>
  <text x="1300" y="232" font-size="12" font-weight="700" fill="#334155">Phase D: Secondary controls</text>

  <!-- Web2 blocks -->
  <rect x="42" y="265" width="256" height="96" rx="10" fill="#ffffff" stroke="#dbeafe" stroke-width="2"/>
  <text x="170" y="296" font-size="16" font-weight="700" fill="#1e293b" text-anchor="middle">Issuer Desk / Admin</text>
  <text x="170" y="316" font-size="11" fill="#64748b" text-anchor="middle">Defines rounds, caps, lockups,</text>
  <text x="170" y="333" font-size="11" fill="#64748b" text-anchor="middle">authorized investors and treasury</text>

  <rect x="42" y="380" width="256" height="184" rx="10" fill="#ffffff" stroke="#dbeafe" stroke-width="2"/>
  <text x="170" y="412" font-size="16" font-weight="700" fill="#1e293b" text-anchor="middle">Lambda + DynamoDB</text>
  <text x="170" y="433" font-size="11" fill="#64748b" text-anchor="middle">Actions:</text>
  <text x="170" y="449" font-size="10" fill="#64748b" text-anchor="middle">CompanyInvestorInput</text>
  <text x="170" y="465" font-size="10" fill="#64748b" text-anchor="middle">CompanyRoundInput</text>
  <text x="170" y="481" font-size="10" fill="#64748b" text-anchor="middle">CompanyRoundAllowlistBatchInput</text>
  <text x="170" y="497" font-size="10" fill="#64748b" text-anchor="middle">MarketPurchaseSettlementInput</text>
  <text x="170" y="513" font-size="10" fill="#64748b" text-anchor="middle">MarketPurchaseRefundInput</text>
  <text x="170" y="531" font-size="10" fill="#334155" text-anchor="middle">Stores: investor:*, round:*,</text>
  <text x="170" y="547" font-size="10" fill="#334155" text-anchor="middle">purchase:*, aceSettlement:*</text>

  <rect x="42" y="586" width="256" height="150" rx="10" fill="#ffffff" stroke="#dbeafe" stroke-width="2"/>
  <text x="170" y="617" font-size="16" font-weight="700" fill="#1e293b" text-anchor="middle">Settlement Worker</text>
  <text x="170" y="638" font-size="11" fill="#64748b" text-anchor="middle">Consumes PurchaseRequested</text>
  <text x="170" y="655" font-size="11" fill="#64748b" text-anchor="middle">Calls ACE private transfer</text>
  <text x="170" y="672" font-size="11" fill="#64748b" text-anchor="middle">Then triggers settle/refund</text>
  <text x="170" y="690" font-size="10" fill="#0f766e" text-anchor="middle">Idempotent via aceSettlement record</text>

  <rect x="42" y="760" width="256" height="184" rx="10" fill="#ffffff" stroke="#dbeafe" stroke-width="2"/>
  <text x="170" y="791" font-size="16" font-weight="700" fill="#1e293b" text-anchor="middle">Validation / E2E</text>
  <text x="170" y="812" font-size="10" fill="#64748b" text-anchor="middle">test:private-rounds-market</text>
  <text x="170" y="828" font-size="10" fill="#64748b" text-anchor="middle">- unauthorized buy revert</text>
  <text x="170" y="844" font-size="10" fill="#64748b" text-anchor="middle">- cap exceeded revert</text>
  <text x="170" y="860" font-size="10" fill="#64748b" text-anchor="middle">- settle transfers USDC treasury</text>
  <text x="170" y="876" font-size="10" fill="#64748b" text-anchor="middle">- refund transitions to REFUNDED</text>
  <text x="170" y="892" font-size="10" fill="#64748b" text-anchor="middle">- lockup/global resale blocked</text>

  <!-- CRE blocks -->
  <rect x="360" y="265" width="350" height="88" rx="10" fill="#ecfeff" stroke="#67e8f9" stroke-width="2"/>
  <text x="535" y="296" font-size="16" font-weight="700" fill="#155e75" text-anchor="middle">HTTP Trigger</text>
  <text x="535" y="317" font-size="11" fill="#0f766e" text-anchor="middle">Parses company payloads and validates schema</text>
  <text x="535" y="334" font-size="11" fill="#0f766e" text-anchor="middle">(actions 0..17)</text>

  <rect x="360" y="370" width="350" height="220" rx="10" fill="#eff6ff" stroke="#bfdbfe" stroke-width="2"/>
  <text x="535" y="400" font-size="17" font-weight="700" fill="#1e3a8a" text-anchor="middle">Action Router (main.ts)</text>
  <text x="535" y="421" font-size="11" fill="#334155" text-anchor="middle">New market actions:</text>
  <text x="535" y="438" font-size="10" fill="#334155" text-anchor="middle">9 auth, 10 lockup, 11 create round, 12 allowlist</text>
  <text x="535" y="454" font-size="10" fill="#334155" text-anchor="middle">13 open, 14 close, 15 settle, 16 refund, 17 set compliance</text>
  <text x="535" y="472" font-size="10" fill="#334155" text-anchor="middle">ABI encoding -> report bytes -> writeReport()</text>
  <text x="535" y="490" font-size="10" fill="#334155" text-anchor="middle">Also supports ACE_PRIVATE_TRANSFER / ACE_WITHDRAW_TICKET</text>
  <text x="535" y="508" font-size="10" fill="#334155" text-anchor="middle">using EIP-712 signatures</text>
  <rect x="388" y="525" width="294" height="50" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1"/>
  <text x="535" y="545" font-size="10" font-weight="700" fill="#475569" text-anchor="middle">Log triggers watch</text>
  <text x="535" y="561" font-size="10" fill="#64748b" text-anchor="middle">IdentityRegistry + PrivateEmployeeEquity + ComplianceV2 + PrivateRoundsMarket</text>

  <rect x="360" y="612" width="350" height="122" rx="10" fill="#f5f3ff" stroke="#c4b5fd" stroke-width="2"/>
  <text x="535" y="643" font-size="16" font-weight="700" fill="#5b21b6" text-anchor="middle">ACE HTTP Capability</text>
  <text x="535" y="664" font-size="11" fill="#6d28d9" text-anchor="middle">Signs and posts to ACE API endpoints</text>
  <text x="535" y="681" font-size="11" fill="#6d28d9" text-anchor="middle">/private-transfer and /withdraw</text>
  <text x="535" y="698" font-size="10" fill="#7c3aed" text-anchor="middle">Domain: CompliantPrivateTokenDemo (Sepolia)</text>

  <rect x="360" y="756" width="350" height="188" rx="10" fill="#eef2ff" stroke="#a5b4fc" stroke-width="2"/>
  <text x="535" y="787" font-size="16" font-weight="700" fill="#312e81" text-anchor="middle">Operational Paths</text>
  <text x="535" y="808" font-size="10" fill="#4338ca" text-anchor="middle">Production: report() -> receiver via forwarder</text>
  <text x="535" y="824" font-size="10" fill="#4338ca" text-anchor="middle">Local test: direct onReport (bypass forwarder)</text>
  <text x="535" y="843" font-size="10" fill="#4338ca" text-anchor="middle">Settlement OK: action 15 mark settled</text>
  <text x="535" y="859" font-size="10" fill="#4338ca" text-anchor="middle">Settlement fail: action 16 refund</text>
  <text x="535" y="875" font-size="10" fill="#4338ca" text-anchor="middle">Token compliance switch: action 17</text>
  <text x="535" y="891" font-size="10" fill="#4338ca" text-anchor="middle">Global transfer rules enforced by ComplianceV2</text>

  <!-- Onchain blocks -->
  <rect x="770" y="265" width="430" height="105" rx="10" fill="#4f46e5" stroke="#818cf8" stroke-width="2"/>
  <text x="985" y="297" font-size="18" font-weight="700" fill="#ffffff" text-anchor="middle">EquityWorkflowReceiver</text>
  <text x="985" y="318" font-size="11" fill="#e0e7ff" text-anchor="middle">Dispatches actions 0..17 to protocol modules</text>
  <text x="985" y="335" font-size="11" fill="#e0e7ff" text-anchor="middle">Owner of Token + IdentityRegistry, oracle in market/equity modules</text>
  <text x="985" y="352" font-size="11" fill="#e0e7ff" text-anchor="middle">SYNC_REDEEM_TICKET remains disabled by design</text>

  <rect x="770" y="386" width="210" height="172" rx="10" fill="#0b2535" stroke="#38bdf8" stroke-width="2"/>
  <text x="875" y="417" font-size="14" font-weight="700" fill="#e0f2fe" text-anchor="middle">ComplianceV2</text>
  <text x="875" y="437" font-size="10" fill="#bae6fd" text-anchor="middle">authorizedInvestor</text>
  <text x="875" y="454" font-size="10" fill="#bae6fd" text-anchor="middle">investorLockupUntil</text>
  <text x="875" y="471" font-size="10" fill="#bae6fd" text-anchor="middle">trustedCounterparties</text>
  <text x="875" y="488" font-size="10" fill="#bae6fd" text-anchor="middle">canTransfer(): global rule</text>
  <text x="875" y="505" font-size="10" fill="#bae6fd" text-anchor="middle">KYC + auth + lockup checks</text>
  <text x="875" y="522" font-size="10" fill="#bae6fd" text-anchor="middle">(regulatory unwind allowed)</text>

  <rect x="990" y="386" width="210" height="172" rx="10" fill="#052e16" stroke="#34d399" stroke-width="2"/>
  <text x="1095" y="417" font-size="14" font-weight="700" fill="#ecfdf5" text-anchor="middle">PrivateRoundsMarket</text>
  <text x="1095" y="437" font-size="10" fill="#a7f3d0" text-anchor="middle">create/open/close rounds</text>
  <text x="1095" y="454" font-size="10" fill="#a7f3d0" text-anchor="middle">allowlist + per-investor cap</text>
  <text x="1095" y="471" font-size="10" fill="#a7f3d0" text-anchor="middle">buyRound -> PENDING</text>
  <text x="1095" y="488" font-size="10" fill="#a7f3d0" text-anchor="middle">markPurchaseSettled -> treasury</text>
  <text x="1095" y="505" font-size="10" fill="#a7f3d0" text-anchor="middle">refundPurchase / refundByOracle</text>
  <text x="1095" y="522" font-size="10" fill="#a7f3d0" text-anchor="middle">status: PENDING/SETTLED/REFUNDED</text>

  <rect x="770" y="575" width="210" height="150" rx="10" fill="#111827" stroke="#22c55e" stroke-width="2"/>
  <text x="875" y="606" font-size="14" font-weight="700" fill="#f8fafc" text-anchor="middle">Token ERC-3643</text>
  <text x="875" y="626" font-size="10" fill="#bbf7d0" text-anchor="middle">transfer/transferFrom call</text>
  <text x="875" y="643" font-size="10" fill="#bbf7d0" text-anchor="middle">ComplianceV2.canTransfer()</text>
  <text x="875" y="660" font-size="10" fill="#bbf7d0" text-anchor="middle">Global resale restrictions</text>
  <text x="875" y="677" font-size="10" fill="#bbf7d0" text-anchor="middle">setCompliance via action 17</text>
  <text x="875" y="694" font-size="10" fill="#bbf7d0" text-anchor="middle">freeze controls remain available</text>

  <rect x="990" y="575" width="210" height="150" rx="10" fill="#334155" stroke="#94a3b8" stroke-width="1.8"/>
  <text x="1095" y="606" font-size="14" font-weight="700" fill="#f8fafc" text-anchor="middle">IdentityRegistry</text>
  <text x="1095" y="626" font-size="10" fill="#cbd5e1" text-anchor="middle">KYC source of truth</text>
  <text x="1095" y="643" font-size="10" fill="#cbd5e1" text-anchor="middle">verified identities + country</text>
  <text x="1095" y="660" font-size="10" fill="#cbd5e1" text-anchor="middle">used by token/compliance</text>

  <rect x="770" y="742" width="210" height="202" rx="10" fill="#1f2937" stroke="#9ca3af" stroke-width="1.8"/>
  <text x="875" y="773" font-size="14" font-weight="700" fill="#f8fafc" text-anchor="middle">MockUSDC (6 decimals)</text>
  <text x="875" y="793" font-size="10" fill="#d1d5db" text-anchor="middle">Buyer approves market</text>
  <text x="875" y="810" font-size="10" fill="#d1d5db" text-anchor="middle">buyRound escrows USDC</text>
  <text x="875" y="827" font-size="10" fill="#d1d5db" text-anchor="middle">settled -> USDC treasury</text>
  <text x="875" y="844" font-size="10" fill="#d1d5db" text-anchor="middle">refund -> USDC buyer</text>

  <rect x="990" y="742" width="210" height="202" rx="10" fill="#082f49" stroke="#38bdf8" stroke-width="1.8"/>
  <text x="1095" y="773" font-size="14" font-weight="700" fill="#e0f2fe" text-anchor="middle">PrivateEmployeeEquity</text>
  <text x="1095" y="793" font-size="10" fill="#bae6fd" text-anchor="middle">ACE vault integration</text>
  <text x="1095" y="810" font-size="10" fill="#bae6fd" text-anchor="middle">employment + goal + cliff</text>
  <text x="1095" y="827" font-size="10" fill="#bae6fd" text-anchor="middle">claim gating before redeem</text>
  <text x="1095" y="844" font-size="10" fill="#bae6fd" text-anchor="middle">ticket redeem remains wallet-driven</text>

  <!-- ACE rail -->
  <rect x="1260" y="265" width="200" height="160" rx="10" fill="#ffffff" stroke="#d8b4fe" stroke-width="2"/>
  <text x="1360" y="296" font-size="16" font-weight="700" fill="#5b21b6" text-anchor="middle">ACE API</text>
  <text x="1360" y="317" font-size="10" fill="#6d28d9" text-anchor="middle">/private-transfer</text>
  <text x="1360" y="334" font-size="10" fill="#6d28d9" text-anchor="middle">/withdraw /shielded-address</text>
  <text x="1360" y="351" font-size="10" fill="#6d28d9" text-anchor="middle">EIP-712 authenticated requests</text>
  <text x="1360" y="368" font-size="10" fill="#6d28d9" text-anchor="middle">private balances + tx ids</text>
  <text x="1360" y="385" font-size="10" fill="#7c3aed" text-anchor="middle">vault policy checks enforced</text>

  <rect x="1260" y="443" width="200" height="190" rx="10" fill="#ffffff" stroke="#d8b4fe" stroke-width="2"/>
  <text x="1360" y="474" font-size="15" font-weight="700" fill="#5b21b6" text-anchor="middle">Settlement Decision</text>
  <text x="1360" y="495" font-size="10" fill="#6d28d9" text-anchor="middle">ACE transfer success</text>
  <text x="1360" y="512" font-size="10" fill="#6d28d9" text-anchor="middle">-> send action 15 (SETTLED)</text>
  <text x="1360" y="530" font-size="10" fill="#6d28d9" text-anchor="middle">ACE failure/timeout</text>
  <text x="1360" y="547" font-size="10" fill="#6d28d9" text-anchor="middle">-> send action 16 (REFUNDED)</text>
  <text x="1360" y="565" font-size="10" fill="#7c3aed" text-anchor="middle">No USDC trapped without route</text>
  <text x="1360" y="582" font-size="10" fill="#7c3aed" text-anchor="middle">for resolution</text>

  <rect x="1260" y="650" width="200" height="294" rx="10" fill="#faf5ff" stroke="#c084fc" stroke-width="2"/>
  <text x="1360" y="681" font-size="15" font-weight="700" fill="#6d28d9" text-anchor="middle">Privacy Outcome</text>
  <text x="1360" y="702" font-size="10" fill="#7c3aed" text-anchor="middle">Investor token allocations</text>
  <text x="1360" y="719" font-size="10" fill="#7c3aed" text-anchor="middle">can stay private on ACE rail</text>
  <text x="1360" y="737" font-size="10" fill="#7c3aed" text-anchor="middle">while compliance remains</text>
  <text x="1360" y="754" font-size="10" fill="#7c3aed" text-anchor="middle">enforced globally on token</text>
  <text x="1360" y="772" font-size="10" fill="#7c3aed" text-anchor="middle">payment (USDC) visibility</text>
  <text x="1360" y="789" font-size="10" fill="#7c3aed" text-anchor="middle">is accepted in this phase</text>

  <!-- Investor lane -->
  <rect x="1515" y="265" width="130" height="160" rx="10" fill="#ffffff" stroke="#99f6e4" stroke-width="2"/>
  <text x="1580" y="296" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Authorized</text>
  <text x="1580" y="314" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Investor</text>
  <text x="1580" y="334" font-size="10" fill="#0f766e" text-anchor="middle">KYC + allowlist</text>
  <text x="1580" y="351" font-size="10" fill="#0f766e" text-anchor="middle">Buys round with USDC</text>
  <text x="1580" y="368" font-size="10" fill="#0f766e" text-anchor="middle">Receives private token flow</text>
  <text x="1580" y="385" font-size="10" fill="#0f766e" text-anchor="middle">Can later redeem ticket</text>

  <rect x="1515" y="443" width="130" height="160" rx="10" fill="#ffffff" stroke="#99f6e4" stroke-width="2"/>
  <text x="1580" y="474" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Unauthorized</text>
  <text x="1580" y="492" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Address</text>
  <text x="1580" y="512" font-size="10" fill="#0f766e" text-anchor="middle">Buy rejected</text>
  <text x="1580" y="529" font-size="10" fill="#0f766e" text-anchor="middle">Transfer receive rejected</text>
  <text x="1580" y="546" font-size="10" fill="#0f766e" text-anchor="middle">by ComplianceV2</text>

  <rect x="1515" y="650" width="130" height="294" rx="10" fill="#ffffff" stroke="#99f6e4" stroke-width="2"/>
  <text x="1580" y="681" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Secondary</text>
  <text x="1580" y="699" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Resale Rules</text>
  <text x="1580" y="719" font-size="10" fill="#0f766e" text-anchor="middle">Lockup active:</text>
  <text x="1580" y="736" font-size="10" fill="#0f766e" text-anchor="middle">sender transfer blocked</text>
  <text x="1580" y="754" font-size="10" fill="#0f766e" text-anchor="middle">Lockup expired:</text>
  <text x="1580" y="771" font-size="10" fill="#0f766e" text-anchor="middle">transfer allowed only</text>
  <text x="1580" y="788" font-size="10" fill="#0f766e" text-anchor="middle">to authorized investors</text>

  <!-- Flow arrows -->
  <!-- 1. setup (Issuer to HTTP Trigger) -->
  <path d="M 298 313 L 360 313" fill="none" stroke="#2563eb" stroke-width="3" marker-end="url(#arrBlue)"/>

  <!-- 2. CRE to Onchain (Router to Receiver) -->
  <path d="M 710 430 L 750 430 L 750 317 L 770 317" fill="none" stroke="#2563eb" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrBlue)"/>

  <!-- 3. Receiver to Compliance and Market (Branching) -->
  <path d="M 875 370 L 875 386" fill="none" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrGray)"/>
  <path d="M 1095 370 L 1095 386" fill="none" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrGray)"/>

  <!-- 4. buy path (Investor to Market) -->
  <path d="M 1515 351 L 1490 351 L 1490 434 L 1220 434 L 1220 481 L 1200 481" fill="none" stroke="#ea580c" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrOrange)"/>

  <!-- 5. MockUSDC to Market -->
  <path d="M 980 817 L 985 817 L 985 481 L 990 481" fill="none" stroke="#ea580c" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrOrange)"/>

  <!-- 6. purchase event to lambda (Market to Worker) -->
  <path d="M 990 506 L 740 506 L 740 600 L 330 600 L 330 674 L 298 674" fill="none" stroke="#10b981" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrGreen)"/>

  <!-- 7. Worker to ACE HTTP Cap -->
  <path d="M 298 674 L 360 674" fill="none" stroke="#7c3aed" stroke-width="3" marker-end="url(#arrPurple)"/>

  <!-- 8. ACE HTTP Cap to ACE API -->
  <path d="M 710 674 L 725 674 L 725 735 L 1225 735 L 1225 330 L 1260 330" fill="none" stroke="#7c3aed" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrPurple)"/>

  <!-- 9. ACE Rail to CRE Action Router -->
  <path d="M 1260 529 L 1235 529 L 1235 565 L 740 565 L 740 529 L 710 529" fill="none" stroke="#7c3aed" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrPurple)"/>

  <!-- 10. CRE Action Router to Market -->
  <path d="M 710 506 L 990 506" fill="none" stroke="#2563eb" stroke-width="3" marker-end="url(#arrBlue)"/>

  <!-- 11. Market to EmployeeEquity (Wait, text says "settled and refunded branches") -->
  <path d="M 1095 558 L 1095 566 L 1210 566 L 1210 735 L 1095 735 L 1095 742" fill="none" stroke="#94a3b8" stroke-width="2" stroke-linejoin="round" marker-end="url(#arrGray)"/>

  <!-- 12. Market to MockUSDC (Event sync / settle) -->
  <path d="M 1095 558 L 1095 566 L 985 566 L 985 755 L 980 755" fill="none" stroke="#10b981" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrGreen)"/>

  <!-- 13. Market to MockUSDC (Refund path) -->
  <path d="M 1095 558 L 1095 566 L 985 566 L 985 765 L 980 765" fill="none" stroke="#ea580c" stroke-width="3" stroke-dasharray="5 5" stroke-linejoin="round" marker-end="url(#arrOrange)"/>

  <!-- 14. compliance enforcement to unauthorized address -->
  <path d="M 980 447 L 985 447 L 985 566 L 1225 566 L 1225 434 L 1490 434 L 1490 523 L 1515 523" fill="none" stroke="#2563eb" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrBlue)"/>

  <!-- 15. compliance enforcement to secondary resale -->
  <path d="M 980 643 L 985 643 L 985 734 L 1225 734 L 1225 641 L 1490 641 L 1490 719 L 1515 719" fill="none" stroke="#2563eb" stroke-width="3" stroke-linejoin="round" marker-end="url(#arrBlue)"/>

  <!-- legend -->
  <rect x="20" y="990" width="1640" height="22" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1"/>
  <line x1="40" y1="1001" x2="80" y2="1001" stroke="#2563eb" stroke-width="3" marker-end="url(#arrBlue)"/>
  <text x="88" y="1005" font-size="10" fill="#334155">Onchain control/update path</text>
  <line x1="315" y1="1001" x2="355" y2="1001" stroke="#10b981" stroke-width="3" marker-end="url(#arrGreen)"/>
  <text x="363" y="1005" font-size="10" fill="#334155">Event sync / reconciliation path</text>
  <line x1="620" y1="1001" x2="660" y2="1001" stroke="#7c3aed" stroke-width="3" marker-end="url(#arrPurple)"/>
  <text x="668" y="1005" font-size="10" fill="#334155">ACE private rail and settlement decision</text>
  <line x1="1010" y1="1001" x2="1050" y2="1001" stroke="#ea580c" stroke-width="3" marker-end="url(#arrOrange)"/>
  <text x="1058" y="1005" font-size="10" fill="#334155">Trading/payment path (USDC visible onchain)</text>
</svg>
