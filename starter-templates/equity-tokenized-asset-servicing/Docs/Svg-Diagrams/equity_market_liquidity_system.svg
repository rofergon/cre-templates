<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1680 1040" width="100%" height="100%" style="background:#f4f8fc;font-family:'Segoe UI','Inter',Arial,sans-serif;">
  <defs>
    <filter id="shadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="3" stdDeviation="6" flood-color="#0f172a" flood-opacity="0.12"/>
    </filter>

    <linearGradient id="laneOps" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffffff"/>
      <stop offset="100%" stop-color="#eaf3ff"/>
    </linearGradient>
    <linearGradient id="laneCre" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#2a5ada"/>
      <stop offset="100%" stop-color="#193db0"/>
    </linearGradient>
    <linearGradient id="laneChain" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#1f2937"/>
      <stop offset="100%" stop-color="#111827"/>
    </linearGradient>
    <linearGradient id="laneAce" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffffff"/>
      <stop offset="100%" stop-color="#f6ecff"/>
    </linearGradient>
    <linearGradient id="laneUser" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffffff"/>
      <stop offset="100%" stop-color="#ecfeff"/>
    </linearGradient>

    <marker id="arrBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb"/>
    </marker>
    <marker id="arrGreen" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#059669"/>
    </marker>
    <marker id="arrPurple" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#7c3aed"/>
    </marker>
    <marker id="arrGray" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/>
    </marker>
  </defs>

  <text x="840" y="52" font-size="34" font-weight="700" fill="#0f172a" text-anchor="middle">Equity Private Liquidity Market System</text>
  <text x="840" y="82" font-size="15" fill="#475569" text-anchor="middle">ERC-3643 + ComplianceV2 + PrivateRoundsMarket + CRE + ACE privacy settlement</text>

  <rect x="20" y="120" width="330" height="900" rx="16" fill="url(#laneOps)" stroke="#cbd5e1" stroke-width="2" filter="url(#shadow)"/>
  <rect x="370" y="120" width="350" height="900" rx="16" fill="#ffffff" stroke="#1d4ed8" stroke-width="3" filter="url(#shadow)"/>
  <rect x="370" y="120" width="350" height="84" rx="16" fill="url(#laneCre)"/>
  <path d="M 370 188 L 720 188 L 720 204 L 370 204 Z" fill="url(#laneCre)"/>
  <rect x="740" y="120" width="520" height="900" rx="16" fill="url(#laneChain)" filter="url(#shadow)"/>
  <rect x="1280" y="120" width="220" height="900" rx="16" fill="url(#laneAce)" stroke="#d8b4fe" stroke-width="2" filter="url(#shadow)"/>
  <rect x="1520" y="120" width="140" height="900" rx="16" fill="url(#laneUser)" stroke="#99f6e4" stroke-width="2" filter="url(#shadow)"/>

  <text x="185" y="170" font-size="22" font-weight="700" fill="#334155" text-anchor="middle">Company + Lambda</text>
  <text x="545" y="171" font-size="22" font-weight="700" fill="#ffffff" text-anchor="middle">CRE Workflow</text>
  <text x="545" y="194" font-size="12" fill="#dbeafe" text-anchor="middle">main.ts + action routing + writeReport + ACE calls</text>
  <text x="1000" y="170" font-size="23" font-weight="700" fill="#ffffff" text-anchor="middle">Onchain Protocol</text>
  <text x="1390" y="170" font-size="21" font-weight="700" fill="#6d28d9" text-anchor="middle">ACE Rail</text>
  <text x="1590" y="170" font-size="20" font-weight="700" fill="#0f766e" text-anchor="middle">Users</text>

  <rect x="30" y="216" width="1630" height="30" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1.5"/>
  <text x="46" y="236" font-size="12" font-weight="700" fill="#334155">A) Onboard &amp; authorize investors</text>
  <text x="415" y="236" font-size="12" font-weight="700" fill="#334155">B) Create/open private round</text>
  <text x="740" y="236" font-size="12" font-weight="700" fill="#334155">C) Buy with USDC (PENDING)</text>
  <text x="1040" y="236" font-size="12" font-weight="700" fill="#334155">D) ACE settlement or refund</text>
  <text x="1360" y="236" font-size="12" font-weight="700" fill="#334155">E) Global resale compliance</text>

  <rect x="42" y="270" width="286" height="150" rx="10" fill="#ffffff" stroke="#dbeafe" stroke-width="2"/>
  <text x="185" y="300" font-size="16" font-weight="700" fill="#1e293b" text-anchor="middle">Issuer Ops</text>
  <text x="185" y="321" font-size="11" fill="#64748b" text-anchor="middle">Define investor KYC and authorization</text>
  <text x="185" y="338" font-size="11" fill="#64748b" text-anchor="middle">Set lockup and trusted counterparties</text>
  <text x="185" y="355" font-size="11" fill="#64748b" text-anchor="middle">Create round terms and allowlist caps</text>
  <text x="185" y="374" font-size="10" fill="#334155" text-anchor="middle">Input via Lambda API</text>

  <rect x="42" y="438" width="286" height="220" rx="10" fill="#ffffff" stroke="#dbeafe" stroke-width="2"/>
  <text x="185" y="470" font-size="16" font-weight="700" fill="#1e293b" text-anchor="middle">Lambda + DynamoDB</text>
  <text x="185" y="491" font-size="10" fill="#64748b" text-anchor="middle">CompanyInvestorInput / CompanyRoundInput</text>
  <text x="185" y="507" font-size="10" fill="#64748b" text-anchor="middle">CompanyRoundAllowlistBatchInput</text>
  <text x="185" y="523" font-size="10" fill="#64748b" text-anchor="middle">MarketPurchaseSettlementInput / RefundInput</text>
  <text x="185" y="542" font-size="10" fill="#334155" text-anchor="middle">State keys:</text>
  <text x="185" y="558" font-size="10" fill="#334155" text-anchor="middle">investor:*, round:*, purchase:*</text>
  <text x="185" y="574" font-size="10" fill="#334155" text-anchor="middle">aceSettlement:* (idempotency)</text>
  <text x="185" y="596" font-size="10" fill="#0f766e" text-anchor="middle">pushes actions to CRE HTTP trigger</text>

  <rect x="42" y="678" width="286" height="244" rx="10" fill="#ffffff" stroke="#dbeafe" stroke-width="2"/>
  <text x="185" y="710" font-size="16" font-weight="700" fill="#1e293b" text-anchor="middle">Settlement Worker</text>
  <text x="185" y="731" font-size="10" fill="#64748b" text-anchor="middle">Reads PurchaseRequested events</text>
  <text x="185" y="747" font-size="10" fill="#64748b" text-anchor="middle">Calls ACE private-transfer</text>
  <text x="185" y="763" font-size="10" fill="#64748b" text-anchor="middle">If success: mark settled</text>
  <text x="185" y="779" font-size="10" fill="#64748b" text-anchor="middle">If timeout/fail: trigger refund</text>
  <text x="185" y="801" font-size="10" fill="#334155" text-anchor="middle">Uses Lambda action:</text>
  <text x="185" y="817" font-size="10" fill="#334155" text-anchor="middle">ManualSyncToCre / MarketPurchase*</text>
  <text x="185" y="839" font-size="10" fill="#0f766e" text-anchor="middle">No funds stuck path</text>

  <rect x="390" y="270" width="310" height="128" rx="10" fill="#ecfeff" stroke="#67e8f9" stroke-width="2"/>
  <text x="545" y="302" font-size="16" font-weight="700" fill="#155e75" text-anchor="middle">HTTP Trigger</text>
  <text x="545" y="323" font-size="10" fill="#0f766e" text-anchor="middle">validates payload + maps action ids</text>
  <text x="545" y="339" font-size="10" fill="#0f766e" text-anchor="middle">supports employee flow and market flow</text>
  <text x="545" y="355" font-size="10" fill="#0f766e" text-anchor="middle">actions 0..17</text>

  <rect x="390" y="418" width="310" height="292" rx="10" fill="#eff6ff" stroke="#bfdbfe" stroke-width="2"/>
  <text x="545" y="449" font-size="17" font-weight="700" fill="#1e3a8a" text-anchor="middle">Action Router (main.ts)</text>
  <text x="545" y="471" font-size="10" fill="#334155" text-anchor="middle">9 auth, 10 lockup, 11 create round</text>
  <text x="545" y="487" font-size="10" fill="#334155" text-anchor="middle">12 allowlist, 13 open, 14 close</text>
  <text x="545" y="503" font-size="10" fill="#334155" text-anchor="middle">15 settled, 16 refund, 17 set compliance</text>
  <text x="545" y="522" font-size="10" fill="#334155" text-anchor="middle">encodes ABI and sends report bytes</text>
  <rect x="420" y="538" width="250" height="52" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1"/>
  <text x="545" y="558" font-size="10" font-weight="700" fill="#475569" text-anchor="middle">EVM Client Capability</text>
  <text x="545" y="574" font-size="10" fill="#64748b" text-anchor="middle">writeReport() -> receiver</text>
  <rect x="420" y="608" width="250" height="88" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1"/>
  <text x="545" y="628" font-size="10" font-weight="700" fill="#475569" text-anchor="middle">Log Triggers</text>
  <text x="545" y="644" font-size="10" fill="#64748b" text-anchor="middle">IdentityRegistry, ComplianceV2,</text>
  <text x="545" y="660" font-size="10" fill="#64748b" text-anchor="middle">PrivateRoundsMarket, vesting events</text>
  <text x="545" y="676" font-size="10" fill="#64748b" text-anchor="middle">syncs onchain events back to Lambda</text>

  <rect x="390" y="728" width="310" height="194" rx="10" fill="#f5f3ff" stroke="#c4b5fd" stroke-width="2"/>
  <text x="545" y="760" font-size="16" font-weight="700" fill="#5b21b6" text-anchor="middle">ACE HTTP Capability</text>
  <text x="545" y="781" font-size="10" fill="#6d28d9" text-anchor="middle">ACE_PRIVATE_TRANSFER</text>
  <text x="545" y="797" font-size="10" fill="#6d28d9" text-anchor="middle">ACE_WITHDRAW_TICKET</text>
  <text x="545" y="813" font-size="10" fill="#6d28d9" text-anchor="middle">ACE_GENERATE_SHIELDED_ADDRESS</text>
  <text x="545" y="832" font-size="10" fill="#7c3aed" text-anchor="middle">EIP-712 signed requests</text>
  <text x="545" y="848" font-size="10" fill="#7c3aed" text-anchor="middle">CompliantPrivateTokenDemo domain</text>
  <text x="545" y="864" font-size="10" fill="#7c3aed" text-anchor="middle">Sepolia chainId 11155111</text>

  <rect x="760" y="270" width="480" height="108" rx="10" fill="#4f46e5" stroke="#818cf8" stroke-width="2"/>
  <text x="1000" y="303" font-size="18" font-weight="700" fill="#ffffff" text-anchor="middle">EquityWorkflowReceiver</text>
  <text x="1000" y="324" font-size="10" fill="#e0e7ff" text-anchor="middle">Single execution gateway for all CRE actions (0..17)</text>
  <text x="1000" y="340" font-size="10" fill="#e0e7ff" text-anchor="middle">Dispatches to identity, compliance, market, and vesting components</text>
  <text x="1000" y="356" font-size="10" fill="#e0e7ff" text-anchor="middle">SYNC_REDEEM_TICKET remains wallet-driven by employee/investor</text>

  <rect x="760" y="396" width="230" height="170" rx="10" fill="#0b2535" stroke="#38bdf8" stroke-width="2"/>
  <text x="875" y="427" font-size="14" font-weight="700" fill="#e0f2fe" text-anchor="middle">ComplianceV2</text>
  <text x="875" y="447" font-size="10" fill="#bae6fd" text-anchor="middle">authorizedInvestor[]</text>
  <text x="875" y="463" font-size="10" fill="#bae6fd" text-anchor="middle">lockupUntil[]</text>
  <text x="875" y="479" font-size="10" fill="#bae6fd" text-anchor="middle">trustedCounterparties[]</text>
  <text x="875" y="496" font-size="10" fill="#bae6fd" text-anchor="middle">canTransfer() global checks:</text>
  <text x="875" y="512" font-size="10" fill="#bae6fd" text-anchor="middle">KYC + auth + lockup</text>
  <text x="875" y="528" font-size="10" fill="#bae6fd" text-anchor="middle">blocks unauthorized resale</text>

  <rect x="1010" y="396" width="230" height="170" rx="10" fill="#052e16" stroke="#34d399" stroke-width="2"/>
  <text x="1125" y="427" font-size="14" font-weight="700" fill="#ecfdf5" text-anchor="middle">PrivateRoundsMarket</text>
  <text x="1125" y="447" font-size="10" fill="#a7f3d0" text-anchor="middle">create/open/close/cancel rounds</text>
  <text x="1125" y="463" font-size="10" fill="#a7f3d0" text-anchor="middle">allowlist + investor cap</text>
  <text x="1125" y="479" font-size="10" fill="#a7f3d0" text-anchor="middle">buyRound() => PENDING</text>
  <text x="1125" y="496" font-size="10" fill="#a7f3d0" text-anchor="middle">markPurchaseSettled()</text>
  <text x="1125" y="512" font-size="10" fill="#a7f3d0" text-anchor="middle">refundPurchase()/refundByOracle()</text>
  <text x="1125" y="528" font-size="10" fill="#a7f3d0" text-anchor="middle">PENDING/SETTLED/REFUNDED</text>

  <rect x="760" y="584" width="230" height="150" rx="10" fill="#111827" stroke="#22c55e" stroke-width="2"/>
  <text x="875" y="615" font-size="14" font-weight="700" fill="#f8fafc" text-anchor="middle">ERC-3643 Equity Token</text>
  <text x="875" y="635" font-size="10" fill="#bbf7d0" text-anchor="middle">transfer/transferFrom</text>
  <text x="875" y="651" font-size="10" fill="#bbf7d0" text-anchor="middle">calls ComplianceV2</text>
  <text x="875" y="667" font-size="10" fill="#bbf7d0" text-anchor="middle">market liquidity with controls</text>
  <text x="875" y="683" font-size="10" fill="#bbf7d0" text-anchor="middle">prevents non-compliant holders</text>

  <rect x="1010" y="584" width="230" height="150" rx="10" fill="#334155" stroke="#94a3b8" stroke-width="1.8"/>
  <text x="1125" y="615" font-size="14" font-weight="700" fill="#f8fafc" text-anchor="middle">IdentityRegistry</text>
  <text x="1125" y="635" font-size="10" fill="#cbd5e1" text-anchor="middle">onchain KYC + country data</text>
  <text x="1125" y="651" font-size="10" fill="#cbd5e1" text-anchor="middle">source for compliance checks</text>
  <text x="1125" y="667" font-size="10" fill="#cbd5e1" text-anchor="middle">updated by receiver actions</text>
  <text x="1125" y="683" font-size="10" fill="#cbd5e1" text-anchor="middle">via CRE</text>

  <rect x="760" y="752" width="230" height="170" rx="10" fill="#1f2937" stroke="#9ca3af" stroke-width="1.8"/>
  <text x="875" y="783" font-size="14" font-weight="700" fill="#f8fafc" text-anchor="middle">MockUSDC</text>
  <text x="875" y="803" font-size="10" fill="#d1d5db" text-anchor="middle">6 decimals for test rounds</text>
  <text x="875" y="819" font-size="10" fill="#d1d5db" text-anchor="middle">buyer approves market</text>
  <text x="875" y="835" font-size="10" fill="#d1d5db" text-anchor="middle">escrow at buyRound()</text>
  <text x="875" y="851" font-size="10" fill="#d1d5db" text-anchor="middle">release to treasury on settle</text>
  <text x="875" y="867" font-size="10" fill="#d1d5db" text-anchor="middle">return to buyer on refund</text>

  <rect x="1010" y="752" width="230" height="170" rx="10" fill="#082f49" stroke="#38bdf8" stroke-width="1.8"/>
  <text x="1125" y="783" font-size="14" font-weight="700" fill="#e0f2fe" text-anchor="middle">ACE Vault Contract</text>
  <text x="1125" y="803" font-size="10" fill="#bae6fd" text-anchor="middle">official private rail vault</text>
  <text x="1125" y="819" font-size="10" fill="#bae6fd" text-anchor="middle">token + policy engine registered</text>
  <text x="1125" y="835" font-size="10" fill="#bae6fd" text-anchor="middle">withdrawWithTicket for public rail</text>
  <text x="1125" y="851" font-size="10" fill="#bae6fd" text-anchor="middle">called by end-user wallet</text>

  <rect x="1300" y="270" width="180" height="180" rx="10" fill="#ffffff" stroke="#d8b4fe" stroke-width="2"/>
  <text x="1390" y="301" font-size="16" font-weight="700" fill="#5b21b6" text-anchor="middle">ACE API</text>
  <text x="1390" y="322" font-size="10" fill="#6d28d9" text-anchor="middle">/private-transfer</text>
  <text x="1390" y="338" font-size="10" fill="#6d28d9" text-anchor="middle">/withdraw</text>
  <text x="1390" y="354" font-size="10" fill="#6d28d9" text-anchor="middle">/shielded-address</text>
  <text x="1390" y="373" font-size="10" fill="#7c3aed" text-anchor="middle">EIP-712 auth</text>
  <text x="1390" y="389" font-size="10" fill="#7c3aed" text-anchor="middle">5-min timestamp window</text>
  <text x="1390" y="405" font-size="10" fill="#7c3aed" text-anchor="middle">vault policy checks</text>

  <rect x="1300" y="468" width="180" height="220" rx="10" fill="#ffffff" stroke="#d8b4fe" stroke-width="2"/>
  <text x="1390" y="499" font-size="15" font-weight="700" fill="#5b21b6" text-anchor="middle">Settlement Logic</text>
  <text x="1390" y="520" font-size="10" fill="#6d28d9" text-anchor="middle">If private transfer is OK:</text>
  <text x="1390" y="536" font-size="10" fill="#6d28d9" text-anchor="middle">sync action 15 -> SETTLED</text>
  <text x="1390" y="555" font-size="10" fill="#6d28d9" text-anchor="middle">If rejected or timeout:</text>
  <text x="1390" y="571" font-size="10" fill="#6d28d9" text-anchor="middle">sync action 16 -> REFUNDED</text>
  <text x="1390" y="590" font-size="10" fill="#7c3aed" text-anchor="middle">prevents stuck escrow</text>
  <text x="1390" y="606" font-size="10" fill="#7c3aed" text-anchor="middle">idempotent with purchase id</text>

  <rect x="1300" y="706" width="180" height="216" rx="10" fill="#faf5ff" stroke="#c084fc" stroke-width="2"/>
  <text x="1390" y="737" font-size="15" font-weight="700" fill="#6d28d9" text-anchor="middle">Privacy Result</text>
  <text x="1390" y="758" font-size="10" fill="#7c3aed" text-anchor="middle">Investor equity allocation</text>
  <text x="1390" y="774" font-size="10" fill="#7c3aed" text-anchor="middle">stays private on ACE rail</text>
  <text x="1390" y="793" font-size="10" fill="#7c3aed" text-anchor="middle">USDC payment visible onchain</text>
  <text x="1390" y="809" font-size="10" fill="#7c3aed" text-anchor="middle">in this phase by design</text>
  <text x="1390" y="828" font-size="10" fill="#7c3aed" text-anchor="middle">later: optional private payment rail</text>

  <rect x="1532" y="270" width="116" height="210" rx="10" fill="#ffffff" stroke="#99f6e4" stroke-width="2"/>
  <text x="1590" y="301" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Investor</text>
  <text x="1590" y="322" font-size="10" fill="#0f766e" text-anchor="middle">KYC verified</text>
  <text x="1590" y="338" font-size="10" fill="#0f766e" text-anchor="middle">authorized</text>
  <text x="1590" y="354" font-size="10" fill="#0f766e" text-anchor="middle">in round allowlist</text>
  <text x="1590" y="373" font-size="10" fill="#0f766e" text-anchor="middle">buys with USDC</text>
  <text x="1590" y="389" font-size="10" fill="#0f766e" text-anchor="middle">receives private allocation</text>

  <rect x="1532" y="500" width="116" height="188" rx="10" fill="#ffffff" stroke="#99f6e4" stroke-width="2"/>
  <text x="1590" y="531" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Treasury</text>
  <text x="1590" y="552" font-size="10" fill="#0f766e" text-anchor="middle">receives USDC</text>
  <text x="1590" y="568" font-size="10" fill="#0f766e" text-anchor="middle">only after settle</text>
  <text x="1590" y="584" font-size="10" fill="#0f766e" text-anchor="middle">in market contract</text>

  <rect x="1532" y="706" width="116" height="216" rx="10" fill="#ffffff" stroke="#99f6e4" stroke-width="2"/>
  <text x="1590" y="737" font-size="14" font-weight="700" fill="#0f766e" text-anchor="middle">Holder</text>
  <text x="1590" y="758" font-size="10" fill="#0f766e" text-anchor="middle">may withdraw ticket</text>
  <text x="1590" y="774" font-size="10" fill="#0f766e" text-anchor="middle">to public wallet rail</text>
  <text x="1590" y="793" font-size="10" fill="#0f766e" text-anchor="middle">secondary transfer allowed</text>
  <text x="1590" y="809" font-size="10" fill="#0f766e" text-anchor="middle">only if compliance passes</text>

  <!-- A: Issuer Ops to HTTP Trigger -->
  <path d="M 328 340 L 390 340" fill="none" stroke="#64748b" stroke-width="2" marker-end="url(#arrGray)"/>

  <!-- B: Lambda to Action Router -->
  <path d="M 328 550 C 359 550, 359 540, 390 540" fill="none" stroke="#2563eb" stroke-width="2.4" marker-end="url(#arrBlue)"/>

  <!-- C: Settlement Worker to ACE HTTP Cap -->
  <path d="M 328 790 C 359 790, 359 808, 390 808" fill="none" stroke="#7c3aed" stroke-width="2.4" marker-end="url(#arrPurple)"/>

  <!-- D: Action Router EVM to EquityWorkflowReceiver -->
  <path d="M 700 560 C 730 560, 730 324, 760 324" fill="none" stroke="#2563eb" stroke-width="2.6" marker-end="url(#arrBlue)"/>

  <!-- E: EquityRecv to Compliance -->
  <path d="M 875 378 L 875 396" fill="none" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrGray)"/>

  <!-- F: EquityRecv to Market -->
  <path d="M 1125 378 L 1125 396" fill="none" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrGray)"/>

  <!-- G: Investor buys with USDC -->
  <path d="M 1532 380 C 1386 380, 1386 430, 1240 430" fill="none" stroke="#059669" stroke-width="2.4" marker-end="url(#arrGreen)"/>
  <text x="1386" y="370" font-size="10" fill="#10b981" text-anchor="middle">buyRound(usdc) -> PurchaseRequested</text>

  <!-- H: Market to Treasury -->
  <path d="M 1240 500 C 1386 500, 1386 560, 1532 560" fill="none" stroke="#059669" stroke-width="2" marker-end="url(#arrGreen)"/>
  <text x="1386" y="530" font-size="10" fill="#10b981" text-anchor="middle">settled -> treasury paid</text>

  <!-- I: Market to Holder -->
  <path d="M 1240 530 C 1386 530, 1386 780, 1532 780" fill="none" stroke="#94a3b8" stroke-width="2" stroke-dasharray="6 6" marker-end="url(#arrGray)"/>
  <text x="1386" y="660" font-size="10" fill="#94a3b8" text-anchor="middle">refunded -> buyer recovers USDC</text>

  <!-- J: PrivateMarket to ACE Vault -->
  <path d="M 1240 550 L 1250 550 L 1250 780 L 1240 780" fill="none" stroke="#94a3b8" stroke-width="2" stroke-linejoin="round" marker-end="url(#arrGray)"/>
  <text x="1255" y="666" font-size="10" fill="#cbd5e1">ACE-linked token rail</text>

  <!-- K: ACE HTTP Cap to ACE API -->
  <path d="M 700 826 L 725 826 L 725 240 L 1275 240 L 1275 360 L 1300 360" fill="none" stroke="#7c3aed" stroke-width="2.4" stroke-linejoin="round" marker-end="url(#arrPurple)"/>
  <text x="1000" y="235" font-size="10" fill="#7c3aed" text-anchor="middle">ACE_PRIVATE_TRANSFER API call</text>

  <!-- L: Settlement Logic to Log Triggers -->
  <path d="M 1300 540 L 1285 540 L 1285 970 L 725 970 L 725 640 L 700 640" fill="none" stroke="#7c3aed" stroke-width="2.2" stroke-linejoin="round" marker-end="url(#arrPurple)"/>
  <text x="1000" y="965" font-size="10" fill="#7c3aed" text-anchor="middle">action 15 SETTLED or action 16 REFUNDED</text>

  <!-- M: PrivateRoundsMarket to ComplianceV2 -->
  <path d="M 1010 500 L 990 500" fill="none" stroke="#22c55e" stroke-width="2" marker-end="url(#arrGreen)"/>

  <!-- N: ComplianceV2 to Token -->
  <path d="M 875 566 L 875 584" fill="none" stroke="#22c55e" stroke-width="2" marker-end="url(#arrGreen)"/>
  <text x="760" y="576" font-size="10" fill="#86efac">global resale checks on token transfers</text>

  <!-- O: MockUSDC to Market -->
  <path d="M 875 752 L 875 743 L 1000 743 L 1000 460 L 1010 460" fill="none" stroke="#94a3b8" stroke-width="2" stroke-linejoin="round" marker-end="url(#arrGray)"/>
  <text x="960" y="738" font-size="10" fill="#cbd5e1" text-anchor="end">USDC escrow in market</text>

  <rect x="540" y="950" width="600" height="60" rx="12" fill="#fffbeb" stroke="#f59e0b" stroke-width="2"/>
  <text x="840" y="976" font-size="15" font-weight="700" fill="#92400e" text-anchor="middle">Outcome</text>
  <text x="840" y="995" font-size="11" fill="#b45309" text-anchor="middle">Private primary liquidity with issuer custody, policy-enforced resale restrictions, and deterministic settle/refund flow.</text>
</svg>
